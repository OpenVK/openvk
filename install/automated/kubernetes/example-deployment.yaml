apiVersion: v1
items:
- apiVersion: v1
  kind: PersistentVolumeClaim
  metadata:
    name: mysql-primary-pvc
    namespace: openvk
    annotations: {}
      # volume.beta.kubernetes.io/storage-class: "efs-sc"
  spec:
    # storageClassName: efs-sc
    accessModes:
    - ReadWriteOnce
    resources:
      requests:
        storage: 10Gi
- apiVersion: v1
  kind: PersistentVolumeClaim
  metadata:
    name: mysql-eventdb-pvc
    namespace: openvk
    annotations: {}
      # volume.beta.kubernetes.io/storage-class: "efs-sc"
  spec:
    # storageClassName: efs-sc
    accessModes:
    - ReadWriteOnce
    resources:
      requests:
        storage: 10Gi
- apiVersion: apps/v1
  kind: Deployment
  metadata:
    name: openvk
    namespace: openvk
  spec:
    replicas: 1
    revisionHistoryLimit: 10
    selector:
      matchLabels:
        app: openvk
    strategy:
      type: Recreate
    template:
      metadata:
        labels:
          app: openvk
      spec:
        containers:
        - env: []
          image: ghcr.io/openvk/openvk/openvk:latest
          imagePullPolicy: Always
          name: openvk
          ports:
          - containerPort: 80
            name: http
            protocol: TCP
          resources:
            requests:
              cpu: 100m
              memory: 512Mi
          volumeMounts:
          - mountPath: /var/log/openvk
            name: openvk-logs
          - mountPath: /opt/chandler/extensions/available/openvk/openvk.yml
            name: openvk-config
            subPath: openvk.yml
          - mountPath: /opt/chandler/chandler.yml
            name: openvk-config
            subPath: chandler.yml
        dnsPolicy: ClusterFirst
        restartPolicy: Always
        volumes:
        - name: openvk-logs
          emptyDir: {}
        - name: openvk-config
          configMap:
            name: openvk-config
- apiVersion: apps/v1
  kind: Deployment
  metadata:
    name: mysql-primary
    namespace: openvk
  spec:
    replicas: 1
    revisionHistoryLimit: 10
    selector:
      matchLabels:
        app: mysql-primary
    strategy:
      type: Recreate
    template:
      metadata:
        labels:
          app: mysql-primary
      spec:
        containers:
        - env:
          - name: MYSQL_DATABASE
            value: "db"
          - name: MYSQL_USER
            value: "openvk"
          - name: MYSQL_PASSWORD
            value: "openvk"
          - name: MYSQL_RANDOM_ROOT_PASSWORD
            value: "yes"
          image: ghcr.io/openvk/openvk/mysql:8.0-primary
          imagePullPolicy: Always
          name: mysql-primary
          ports:
          - containerPort: 3306
            name: mysql
            protocol: TCP
          resources:
            requests:
              cpu: 100m
              memory: 512Mi
          volumeMounts:
          - mountPath: /var/lib/mysql
            name: mysql-primary
        dnsPolicy: ClusterFirst
        restartPolicy: Always
        volumes:
        - name: mysql-primary
          persistentVolumeClaim:
            claimName: mysql-primary-pvc
- apiVersion: apps/v1
  kind: Deployment
  metadata:
    name: mysql-eventdb
    namespace: openvk
  spec:
    replicas: 1
    revisionHistoryLimit: 10
    selector:
      matchLabels:
        app: mysql-eventdb
    strategy:
      type: Recreate
    template:
      metadata:
        labels:
          app: mysql-eventdb
      spec:
        containers:
        - env:
          - name: MYSQL_DATABASE
            value: "openvk_eventdb"
          - name: MYSQL_USER
            value: "openvk"
          - name: MYSQL_PASSWORD
            value: "openvk"
          - name: MYSQL_RANDOM_ROOT_PASSWORD
            value: "yes"
          image: ghcr.io/openvk/openvk/mysql:8.0-eventdb
          imagePullPolicy: Always
          name: mysql-eventdb
          ports:
          - containerPort: 3306
            name: mysql
            protocol: TCP
          resources:
            requests:
              cpu: 100m
              memory: 512Mi
          volumeMounts:
          - mountPath: /var/lib/mysql
            name: mysql-eventdb
        dnsPolicy: ClusterFirst
        restartPolicy: Always
        volumes:
        - name: mysql-eventdb
          persistentVolumeClaim:
            claimName: mysql-eventdb-pvc
- apiVersion: v1
  kind: Service
  metadata:
    name: mysql-primary-svc
    namespace: openvk
  spec:
    ports:
    - name: mysql
      port: 3306
    selector:
      app: mysql-primary
    type: ClusterIP
- apiVersion: v1
  kind: Service
  metadata:
    name: mysql-eventdb-svc
    namespace: openvk
  spec:
    ports:
    - name: mysql
      port: 3306
    selector:
      app: mysql-eventdb
    type: ClusterIP
- apiVersion: v1
  kind: Service
  metadata:
    name: openvk-svc
    namespace: openvk
  spec:
    ports:
    - name: http
      port: 80
    selector:
      app: openvk
    type: LoadBalancer
kind: List
metadata: {}