{php $id = $audio->getId() . rand(0, 1000)}
{php $isWithdrawn = $audio->isWithdrawn()}
{php $editable = isset($thisUser) && $audio->canBeModifiedBy($thisUser)}
<div id="audioEmbed-{$id}" data-realid="{$audio->getId()}" {if $hideButtons}data-prettyid="{$audio->getPrettyId()}" data-name="{$audio->getName()}"{/if} data-genre="{$audio->getGenre()}" class="audioEmbed {if !$audio->isAvailable()}processed{/if} {if $isWithdrawn}withdrawn{/if}" onmouseenter="!this.classList.contains('inited') ? initPlayer({$id}, {$audio->getKeys()}, {$audio->getURL()}, {$audio->getLength()}) : void(0)">
    <audio class="audio" />

    <div id="miniplayer" class="audioEntry" style="min-height: 39px;">
        <div class="playerButton">
            <div class="playIcon"></div>
        </div>

        <div class="status" style="margin-top: 12px;">
            <div class="mediaInfo" style="margin-bottom: -8px; cursor: pointer;display:flex;width: 85%;">
                <div style="overflow: hidden;text-overflow: ellipsis;white-space: nowrap;">
                    <strong class="performer">
                        <a style="color: unset" href="/search?query=&type=audios&sort=id&only_performers=on&query={$audio->getPerformer()}">{ovk_proc_strtr($audio->getPerformer(), 50)}</a>
                    </strong>
                    â€”
                    <span class="title {if !empty($audio->getLyrics())}withLyrics{/if}">{ovk_proc_strtr($audio->getTitle(), 50)}</span>
                </div>

                <div class="explicitMark" n:if="$audio->isExplicit()"></div>
            </div>
        </div>

        <div class="volume" style="display: flex; flex-direction: column;width:14%;">
            <span class="nobold" data-unformatted="{$audio->getLength()}" style="text-align: center;margin-top: 12px;">{$audio->getFormattedLength()}</span>
            <div class="buttons" style="margin-top: 8px;">
                {php $hasAudio = isset($thisUser) && $audio->isInLibraryOf($thisUser)}

                {if !$hideButtons}
                    <div class="remove-icon musicIcon" data-id="{$audio->getId()}" n:if="isset($thisUser) && $hasAudio" ></div>
                    <div class="add-icon musicIcon" data-id="{$audio->getId()}" n:if="isset($thisUser) && !$hasAudio && !$isWithdrawn" ></div>
                    <div class="edit-icon musicIcon" data-lyrics="{$audio->getLyrics()}" data-title="{$audio->getTitle()}" data-performer="{$audio->getPerformer()}" data-explicit="{(int)$audio->isExplicit()}" data-searchable="{(int)!$audio->isUnlisted()}" n:if="isset($thisUser) && $editable && !$isWithdrawn" ></div>
                    <div class="report-icon musicIcon" data-id="{$audio->getId()}" n:if="isset($thisUser) && !$editable && !$isWithdrawn" ></div>
                {/if}
            </div>
        </div>
    </div>

    <div class="tracks">
        <div class="track" style="margin-top: 3px;display:none">
            <div class="selectableTrack" n:attr="style => $isWithdrawn ? 'display: none;' : ''">
                <div>&nbsp;
                    <!-- actual track -->
                </div>
            </div>
        </div>
    </div>

    <div class="lyrics" n:if="!empty($audio->getLyrics())">
        {nl2br($audio->getLyrics())|noescape}
    </div>
</div>